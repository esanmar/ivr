<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>IVR Realtime Demo — Odigo + OpenAI + SOAP</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121a2a; --muted:#9fb3c8; --text:#e5eef9; --accent:#5b9cff; --ok:#25c59e; --err:#ff6b6b; --border:#1f2a44;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#0b1220 0%,#0d1526 100%);color:var(--text)}
    .container{max-width:1100px;margin:40px auto;padding:0 20px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
    header h1{font-size:22px;margin:0;letter-spacing:.2px}
    .pill{font-size:12px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;color:var(--muted);background:#0f1730}
    .grid{display:grid;gap:20px;grid-template-columns:1fr; }
    @media(min-width:980px){ .grid{grid-template-columns:1fr 1fr;}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;box-shadow:0 10px 20px rgba(0,0,0,.25)}
    .card h2{margin:0 0 6px 0;font-size:18px}
    .sub{color:var(--muted);font-size:13px;margin:0 0 14px 0}
    .badge{display:inline-block;font-size:11px;padding:4px 8px;border-radius:8px;background:#0f2042;color:#c9dcff;border:1px solid #233a72;margin-right:8px}
    label{display:block;font-size:13px;color:#cfe0f5;margin-top:10px}
    input,select,button{
      width:100%;padding:10px 12px;margin-top:6px;border-radius:10px;border:1px solid var(--border);
      background:#0e1933;color:var(--text);outline:none
    }
    input::placeholder{color:#6f83a1}
    .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    .row-3{display:grid;gap:12px;grid-template-columns:1fr 1fr 1fr}
    button{cursor:pointer;transition:transform .02s ease, background .2s}
    button:hover{background:#11214a}
    .btn-primary{background:linear-gradient(180deg,#3669ff,#2b59da);border:1px solid #2a56d1}
    .btn-danger{background:linear-gradient(180deg,#ff6b6b,#e85a5a);border:1px solid #d24f4f}
    .inline{display:flex;align-items:center;gap:10px;margin-top:10px}
    .muted{color:var(--muted);font-size:12px}
    .status{margin-top:10px;font-size:13px}
    .ok{color:var(--ok);font-weight:600}
    .err{color:var(--err);font-weight:600}
    pre{white-space:pre-wrap;word-break:break-word;background:#0f1730;border:1px solid var(--border);padding:12px;border-radius:10px;min-height:120px}
    .help{font-size:13px;color:#cfe0f5;background:#0f1730;border:1px dashed #27407b;border-radius:10px;padding:10px;margin-top:10px}
    .list{margin:8px 0 0 0;padding-left:16px}
    .list li{margin:4px 0}
    .hint{font-size:12px;color:#a7c2ea}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>IVR Realtime Demo</h1>
      <span class="pill">Odigo · OpenAI Realtime · SOAP (Hacienda)</span>
    </header>

    <div class="grid">
      <!-- LADO IZQUIERDO: PRUEBA DE VOZ -->
      <section class="card">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
          <span class="badge">Prueba de voz</span>
          <span class="hint">WebRTC (audio) + fallback reconocimiento local</span>
        </div>
        <h2>Conversación con el agente</h2>
        <p class="sub">El asistente saluda y pide el NIF/DNI. Al reconocerlo, se abre el PDF del certificado.</p>

        <div class="row">
          <div>
            <label>Idioma del agente</label>
            <select id="lang">
              <option value="es" selected>Español</option>
              <option value="eu">Euskera</option>
            </select>
          </div>
          <div>
            <label>Voz (OpenAI)</label>
            <input id="oaiVoice" value="cedar"/>
          </div>
        </div>

        <div class="inline">
          <input type="checkbox" id="compatVoice" checked>
          <label for="compatVoice" class="muted" style="margin:0">
            <strong>Modo compat voz (fallback)</strong> — usa reconocimiento local si el canal de datos no está disponible.
          </label>
        </div>

        <div class="help">
          <strong>DNIs de prueba (no hace falta decir número a número):</strong>
          <ul class="list">
            <li>11658519A</li>
            <li>26180034P</li>
            <li>15501550X</li>
            <li>71387077E</li>
            <li>55000016R</li>
          </ul>
          <div class="hint">Ejemplo (ES): “Mi DNI es <em>cincocinco cero cero cero cero uno seis erre</em>” o “<em>cincuenta y cinco millones…</em>”. Ejemplo (EU): “<em>Nire NANa bost bost zero…</em>”.</div>
        </div>

        <div class="row" style="margin-top:14px">
          <button id="startBtn" class="btn-primary">Iniciar conversación</button>
          <button id="stopBtn" class="btn-danger">Parar</button>
        </div>
        <div id="rtcStatus" class="status muted"></div>

        <h3 style="margin-top:14px">Transcripción</h3>
        <pre id="transcript"></pre>
      </section>

      <!-- LADO DERECHO: PRUEBA SOAP DIRECTA -->
      <section class="card">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
          <span class="badge">Prueba SOAP</span>
          <span class="hint">Llamada directa al servicio web</span>
        </div>
        <h2>Formulario rápido (SOAP directo)</h2>
        <p class="sub">Introduce un NIF/DNI y abre el PDF generado por el servicio.</p>

        <div class="row">
          <div>
            <label for="nif">NIF / DNI</label>
            <input id="nif" placeholder="12345678Z"/>
          </div>
          <!-- Campo 'nombre' oculto por compatibilidad con scripts antiguos -->
          <input id="nombre" value="" style="display:none"/>
        </div>

        <div class="row">
          <div>
            <label for="comprobar">Comprobar</label>
            <select id="comprobar">
              <option value="true" selected>Sí</option>
              <option value="false">No</option>
            </select>
          </div>
          <div>
            <label for="usuario">Usuario</label>
            <input id="usuario" value="Internet"/>
          </div>
        </div>

        <div class="row" style="margin-top:12px">
          <button id="btnCert" class="btn-primary">Obtener certificado (JSON)</button>
          <button id="btnPDF">Abrir PDF (si disponible)</button>
        </div>

        <button id="btnTTS" style="margin-top:10px">Leer respuesta (TTS Euskera)</button>
        <div id="status" class="status muted"></div>

        <h3 style="margin-top:14px">Respuesta JSON</h3>
        <pre id="out"></pre>
      </section>
    </div>
  </div>

  <script defer src="./realtime.js"></script>
  <script defer src="./app.js"></script>
</body>
</html>
